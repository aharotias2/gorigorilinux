# for - コマンドを繰り返す
<div class="outline"></div>
## 基本的な使い方
`for`はシェルの構文の「予約語」です。決まった順番で単語を並べることで意図した動作をさせることができるのが構文で、`for`文はその一つです。
```構文
for [ループ変数] in [リスト]
do
  [コマンド]
done
```
このような構文になります。「for」「in」「do」「done」は予約語と言ってシェルで決められた単語であり、[]で囲まれた「ループ変数」「リスト」「コマンド」は任意になります。
ループ変数は繰り返し文の中で使われる変数で、1回の繰り返しにつきリストの単語が1つずつ割り当てられます。
リストは単語をスペースで空けて行末まで並べたものです。
リストはコマンドの出力にすることもできます。例えば`seq`コマンドで1〜10までのリストを作り、それを`for`文に渡すことができます。`seq 1 10`の出力が`1 2 3 4 5 6 7 8 9 10`になるのでそれを利用するのです。
シェルではコマンドを「\`」で囲むことで別のコマンドの引数にすることができるのですが、`for`文のリストにも使うことができます。
```ターミナル
プロンプト$ for I in \`seq 1 10\` [Enter]
> do [Enter]
>    echo $I [Enter]
> done [Enter]
1
2
3
4
5
6
7
8
9
10
```
上の例では`seq`コマンドで1〜10のリストを作り、それを変数Iに渡し、繰り返しの中で1つずつ`echo`コマンドによって標準出力に書き出しています。

なお`for`文は1行では書けない文なので、1行書いてエンターを押すと、次の行に`> `というプロンプトが表示され、2行目以降を書くようにします。

別の方法として、1行を`;`(セミコロン) によって区切ることで、改行せずに文を続けて書くことができます。上の例は下のように書くこともできます。
```ターミナル
プロンプト$ for I in \`seq 1 10\`; do echo $I; done [Enter]
1
2
3
4
5
6
7
8
9
10
```
ただし`do`の後にはセミコロンがいらず、あるとエラーになるため注意が必要です。
```ターミナル
プロンプト$ for I in \`seq 1 10\`; do; echo $I; done [Enter]
bash: 予期しないトークン \`;' 周辺に構文エラーがあります
```
## リストの単語を引用符で囲んだ場合
単語リストに空白文字を含む言葉がある場合、引用符で囲みます。
```ターミナル
プロンプト$ for I in "hoge hoge" "fuga fuga" "piyo piyo" [Enter]
> do [Enter]
>     echo $I [Enter]
> done [Enter]
hoge hoge
fuga fuga
piyo piyo
```
## シェル引数を一つずつ処理する場合
### 「"$@"」を使う方法
シェルスクリプトファイルとしてBashを書く場合は引数を受け取る場合もあります。
そしてその引数について一つずつ繰り返し処理をしたい場合は以下のように書きます。
: for I in "$@"
こうすると引数を一つずつ処理します。以下のようなスクリプトを「test.sh」として保存します。
```test.sh
#!/bin/bash

for I in "$@"
do
    echo "$I"
done
```
上のスクリプトに実行権限を与え、引数を渡して実行すると次のようになります。
```ターミナル
プロンプト$ ./test.sh aaa bbb ccc [Enter]
aaa
bbb
ccc
```
引数を引用符で囲むと空白を入れることができます。その場合次のように書きます。
```ターミナル
プロンプト$ ./test "aaa aaa" "bbb bbb" "ccc ccc" [Enter]
aaa aaa
bbb bbb
ccc ccc
```
### 「$@」を使う方法
「$@」を引用符で囲まないで使う場合、引数は全て引用符なしとして読み込まれます。例えば次のようなスクリプトを書いた場合
```test2.sh
#!/bin/bash

for I in $@
do
    echo $I
done
```
これに上と前の実行例と同じような引数を渡して実行すると次のようになります。
```ターミナル
プロンプト$ ./test2.sh "aaa aaa" "bbb bbb" "ccc ccc" [Enter]
aaa
aaa
bbb
bbb
ccc
ccc
```
引用符で囲んだ引数もバラされて処理されたのが分かります。
### 「$\*」を使う方法
「$\*」を使う場合、「$@」を使う場合と同じ結果になります。
```test2.sh
#!/bin/bash

for I in $\*
do
    echo $I
done
```
これに上と前の実行例と同じような引数を渡して実行すると次のようになります。
```ターミナル
プロンプト$ ./test2.sh "aaa aaa" "bbb bbb" "ccc ccc" [Enter]
aaa
aaa
bbb
bbb
ccc
ccc
```
### 「"$\*"」を使う場合
「"$\*"」を使う場合、全ての引数が連結されて一つの引数になります。ですので繰り返し処理は行われず、一度だけ処理されます。
```test2.sh
#!/bin/bash

for I in "$\*"
do
    echo $I
done
```
これに上と前の実行例と同じような引数を渡して実行すると次のようになります。
```ターミナル
プロンプト$ ./test2.sh "aaa aaa" "bbb bbb" "ccc ccc" [Enter]
aaa aaa bbb bbb ccc ccc
```
## lsコマンドの結果を繰り返し処理したい場合
### 変数IFSに改行文字を指定する
`ls`コマンドの結果を繰り返し処理したい場合があります。ファイル名に空白が含まれているとファイル名がバラされてしまい、うまくいきません。
そこで`IFS`という変数を使います。`IFS`はループ変数の区切り文字を指定する変数です。デフォルトでは半角空白になっていますがこれに改行文字「\n」を設定することで`ls`コマンドの繰り返し処理ができます。
```ターミナル
プロンプト$ IFS='
' [Enter]
```
ここでは「'」(単引用符)で囲んだ改行を`IFS`に与えています。また、`echo`コマンドを使った次の方法で改行文字を指定することもできます。
```ターミナル
プロンプト$ IFS=\`echo -ne '\n'\` [Enter]
```
これでも改行文字を`for`ループ引数リストの区切り文字に指定できます。
### lsコマンドを実行する
変数`IFS`に改行文字を指定したら`ls`コマンドを`for`ループに渡して実行します。するとファイル名に空白が含まれていても問題なく繰り返し処理ができます。
```ターミナル
プロンプト$ for I in \`ls\`
> do
>   echo $I
> done [Enter]
ファイル名 1
ファイル名 2
ファイル名 3
```
このような具合です。
### 変数IFSの値を戻す
ほとんど必要ないと思いますが、もし元のIFSの値に戻す必要があるなら
: IFS=' '
とすれば元の半角空白に戻ります。
それか、元の値を別の変数に保存しておき、`for`ループが終わったら値を戻すようにするとより汎用性が挙がります。
: SAVE_IFS=$IFS
として保存し、
: IFS=$SAVE_IFS
として戻します。
### その他のコマンドの出力をループする場合
`ls`コマンドの場合と同じようにすれば`find`コマンドや`cat`コマンドの出力も改行区切りで繰り返し処理ができます。




